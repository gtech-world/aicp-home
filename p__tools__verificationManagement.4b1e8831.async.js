"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[2941],{60084:function(we,_,t){t.d(_,{H4:function(){return ae},Kv:function(){return $},Tz:function(){return ie},We:function(){return S},uU:function(){return c}});var re=t(32699),B=t.n(re),z=t(88297);function $(N){var Q=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(0,z.ZP)("/api/product-system/".concat(N,"/detail"),{refreshInterval:Q})}function ae(N){return(0,z.ZP)(B().isNil(N)?null:"/api/verifyRecord/".concat(N,"/detail"))}function S(N){return(0,z.ZP)(N?"/api/inventory/all":null)}function ie(N){return(0,z.ZP)(N?"/api/verifyRecord/verifiers":null)}function c(N){var Q=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(0,z.ZP)("/api/product-system/list/?pageNum=".concat(N,"&pageSize=10"),{refreshInterval:Q})}},94336:function(we,_,t){t.r(_),t.d(_,{default:function(){return Ke}});var re=t(58357),B=t.n(re),z=t(71977),$=t.n(z),ae=t(30577),S=t.n(ae),ie=t(4692),c=t(50959),N=t(51500),Q=t(67747),J=t(67454),Se=t(90967),ve=t.n(Se),be=t(86378),U=t.n(be),ee=t(35888),Ae=t(9107),me=t(72121),ne=t(62353),le=t(1629),se=t(60084),X=t(97707),De=t(32699),M=t.n(De);function Ie(){var m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:5,i=(0,c.useRef)(new AbortController),h=function(f){var p=f,L=function(){if(p.length!==0){var y=p[0];return p=M().drop(p),{file:y,index:f.length-p.length-1}}},A=M().min([m,p.length]),j=M().range(f.length),D=function(){var E=$()(B()().mark(function y(){var o,C,R,x;return B()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(o=L(),!o){l.next=10;break}return C=o.file,R=o.index,l.next=6,(0,X.qM)(C,{signal:i.current.signal});case 6:x=l.sent,j[R]=x,l.next=11;break;case 10:return l.abrupt("return");case 11:l.next=0;break;case 13:case"end":return l.stop()}},y)}));return function(){return E.apply(this,arguments)}}();return Promise.all(M().range(A).map(function(){return D()})).then(function(){return j})};return[h,function(){try{i.current.abort()}catch(F){console.info("abort upfiles")}}]}var O=t(14803),Be=t(84875),Ee=t.n(Be),Le=t(48947),e=t(11527),g=function(i){return(0,e.jsxs)("div",{className:"w-full flex flex-col gap-2.5",children:[(0,e.jsxs)("span",{className:"font-normal leading-6 text-[16px]",children:[i.title,"\uFF1A"]}),i.children]})},b=function(i){return(0,e.jsx)("div",{className:"font-normal leading-[21.79px] text-[16px] text-gray-9",children:i.value})},Re=function(i){var h,F,f,p,L,A,j,D=i.closeModal,E=i.recordId,y=i.type,o=y===void 0?"new":y,C=(0,c.useRef)(null),R=(0,ee.oR)(),x=R.userData,W=(0,se.H4)(E),l=W.isLoading,n=W.data,Z=(0,se.We)(o==="new"||o==="editor"),H=Z.isLoading,I=Z.data,Y=(0,se.Tz)(o==="new"||o==="editor"),k=Y.isLoading,w=Y.data,P=l||H||k,oe=(0,c.useMemo)(function(){return[(I||[]).map(function(u){return U()(U()({},u),{},{text:u.loadName})}),M().findIndex(I,function(u){return u.loadNumber===(n==null?void 0:n.loadNumber)})]},[I,n]),V=ne.dW.apply(void 0,ve()(oe)),s=(0,c.useMemo)(function(){return[(w||[]).map(function(u){return U()(U()({},u),{},{text:u.name})}),M().findIndex(w,function(u){var v;return u.id===(n==null||(v=n.verifyUser)===null||v===void 0?void 0:v.id)})]},[w,n]),a=ne.dW.apply(void 0,ve()(s)),d=(0,Le.Z)({verifyState:!0}),K=S()(d,2),r=K[0],de=K[1],Ge=Ie(),he=S()(Ge,2),ce=he[0],Qe=he[1];(0,c.useEffect)(function(){return Qe},[]);var q=!r.files||r.files.length===0||r.files.length>20||M().findIndex(r.files,function(u){return u.size>=1024*1024*1024*2||u.name.length>=128})>=0,pe=!I||!w||!r.name||V.current<0||a.current<0||q,Je=(0,c.useState)(!1),ge=S()(Je,2),T=ge[0],G=ge[1],Xe=function(){pe||T||(G(!0),ce(r.files).then(function(v){return(0,X._Q)({name:r.name,loadNumber:I[V.current].loadNumber,description:r.desc||"",fileList:v,verifyUserId:w[a.current].id}).then(function(){return D(!0)}).catch(console.error).finally(function(){G(!1)})}))},ye=!n||!I||!w||(r.name||n.name)===n.name&&(r.desc||n.description)===n.description&&((h=I[V.current])===null||h===void 0?void 0:h.loadNumber)===n.loadNumber&&((F=w[a.current])===null||F===void 0?void 0:F.id)===n.verifyUserId&&q,Ye=function(){if(!(ye||T)){var v;G(!0),r.files?v=ce(r.files).then(function(te){return(0,X.u_)(n.id,{name:r.name||n.name,loadNumber:I[V.current].loadNumber,description:r.desc||n.description,fileList:te,verifyUserId:w[a.current].id})}):v=(0,X.u_)(n.id,{name:r.name,loadNumber:I[V.current].loadNumber,description:r.desc,verifyUserId:w[a.current].id}),v.then(function(){return D(!0)}).catch(console.error).finally(function(){G(!1)})}},je=!n||q,qe=function(){je||!r.files||T||(G(!0),ce(r.files).then(function(v){return(0,X.A6)(n.id,v,!0)}).then(function(){return D(!0)}).catch(console.error).finally(function(){G(!1)}))},_e={directory:"",webkitdirectory:""},Ne="w-full shrink-0 px-5 border border-[#DDDDDD]  h-[50px]  bg-[#F8F8F8] rounded-lg",Fe=o==="verify",en=(0,c.useMemo)(function(){var u;if(q||!r.files)return"\u9A8C\u8BC1\u6587\u4EF6";var v=((u=r.files.item(0))===null||u===void 0?void 0:u.webkitRelativePath.split("/")[0])||"\u9A8C\u8BC1\u6587\u4EF6";return(0,O.lS)(v,10,10)},[r.files,q]),Ce=function(){return(0,e.jsx)(g,{title:Fe?"\u9A8C\u8BC1\u6587\u6863":"\u9644\u4EF6",children:(0,e.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,e.jsx)("input",U()(U()({},_e),{},{ref:C,type:"file",hidden:!0,onChange:function(te){return de({files:te.target.files})}})),(0,e.jsx)(le.SW,{}),(0,e.jsx)(b,{value:en}),(0,e.jsx)("div",{onClick:function(te){var fe;return!T&&((fe=C.current)===null||fe===void 0?void 0:fe.click())},className:Ee()("flex  rounded-[4px] leading-4 text-[16px] bg-[#F1F1F1] w-[100px] h-[24px]  text-center items-center justify-center ",T?"cursor-not-allowed":"cursor-pointer"),children:"\u9009\u62E9\u6587\u4EF6\u5939"})]})})};return(0,e.jsx)(c.Fragment,{children:(0,e.jsxs)(me.u_,{className:"rounded-lg",containerClassName:"mx-5 max-w-[640px]",titleClassName:"text-[20px] leading-5 font-bold",title:o==="new"?"\u65B0\u5EFA\u9A8C\u8BC1\u8BB0\u5F55":"\u7F16\u8F91\u9A8C\u8BC1\u8BB0\u5F55",onClose:function(){return D(!1)},children:[(0,e.jsxs)("div",{className:"flex flex-col py-[1px] gap-5 px-5 w-[640px] min-h-[6.25rem] max-h-mc overflow-y-auto",children:[P&&(0,e.jsx)(Ae.g,{}),!P&&(0,e.jsx)(e.Fragment,{children:Fe?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(g,{title:"\u9A8C\u8BC1\u8BB0\u5F55",children:(0,e.jsx)(b,{value:n==null?void 0:n.name})}),(0,e.jsx)(g,{title:"\u9A8C\u8BC1\u8BB0\u5F55ID",children:(0,e.jsx)(b,{value:n==null?void 0:n.id})}),(0,e.jsx)(g,{title:"\u53D1\u8D77\u4EBA",children:(0,e.jsx)(b,{value:n==null||(f=n.createUser)===null||f===void 0?void 0:f.name})}),(0,e.jsx)(g,{title:"\u7EC4\u7EC7\u673A\u6784",children:(0,e.jsx)(b,{value:n==null||(p=n.organization)===null||p===void 0?void 0:p.name})}),(0,e.jsx)(g,{title:"\u63CF\u8FF0",children:(0,e.jsx)(b,{value:n==null?void 0:n.description})}),(0,e.jsx)(g,{title:"\u78B3\u8DB3\u8FF9\u6279\u6B21",children:(0,e.jsx)(b,{value:n==null||(L=n.inventory)===null||L===void 0?void 0:L.loadName})}),(0,e.jsx)(g,{title:"\u78B3\u8DB3\u8FF9\u6279\u6B21ID",children:(0,e.jsx)(b,{value:n==null?void 0:n.loadNumber})}),(0,e.jsx)(g,{title:"\u9A8C\u8BC1\u4EBA",children:(0,e.jsx)(b,{value:n==null||(A=n.verifyUser)===null||A===void 0?void 0:A.name})}),Ce()]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(g,{title:"\u9A8C\u8BC1\u8BB0\u5F55",children:(0,e.jsx)("input",{value:r.name||(n==null?void 0:n.name),onChange:function(v){return de({name:v.target.value})},maxLength:30,className:Ne})}),(0,e.jsx)(g,{title:"\u78B3\u8DB3\u8FF9\u6279\u6B21",children:(0,e.jsx)(ne.ub,U()({},V))}),(0,e.jsx)(g,{title:"\u63CF\u8FF0",children:(0,e.jsx)("input",{value:r.desc||(n==null?void 0:n.description),onChange:function(v){return de({desc:v.target.value})},maxLength:100,className:Ne})}),(0,e.jsx)(g,{title:"\u9009\u62E9\u9A8C\u8BC1\u4EBA",children:(0,e.jsx)(ne.ub,U()({},a))}),(0,e.jsx)(g,{title:"\u53D1\u8D77\u4EBA",children:(0,e.jsx)(b,{value:x==null?void 0:x.name})}),(0,e.jsx)(g,{title:"\u7EC4\u7EC7\u673A\u6784",children:(0,e.jsx)(b,{value:x==null||(j=x.organization)===null||j===void 0?void 0:j.name})}),Ce()]})})]}),!P&&(0,e.jsxs)("div",{className:"flex flex-row justify-between gap-5 mt-5 w-full px-5",children:[o==="new"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(J.u,{defStyle:"btn-primary-1",className:"flex-1",onClick:function(){return D(!1)},children:"\u53D6\u6D88"}),(0,e.jsx)(J.u,{busy:T,disabled:pe,defStyle:"btn-primary",className:"flex-1",onClick:Xe,children:"\u786E\u5B9A"})]}),o==="editor"&&(0,e.jsx)(J.u,{busy:T,disabled:ye,className:"flex-1",onClick:Ye,children:"\u63D0\u4EA4\u66F4\u65B0"}),o==="verify"&&(0,e.jsx)(J.u,{busy:T,disabled:je,className:"flex-1",onClick:qe,children:"\u63D0\u4EA4\u9A8C\u8BC1"})]})]})})},Ve=Re,Ue=t(34210),Me=t.n(Ue),xe=t(24933),Te=function(i){var h=i.closeModal,F=i.fileList,f=(0,c.useState)(!1),p=S()(f,2),L=p[0],A=p[1],j=(0,ee.h3)(),D=function(){var E=$()(B()().mark(function y(){var o,C,R,x;return B()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return A(!0),l.prev=1,o=new(Me()),C="",F.forEach(function(n){C=n.fileName.split("/")[0];var Z=xe.Z.get(n.downloadUrl,{responseType:"arraybuffer"}).then(function(H){return H.data});o.file(n.fileName,Z)}),l.next=7,o.generateAsync({type:"blob"});case 7:R=l.sent,x=document.createElement("a"),x.href=URL.createObjectURL(R),x.download="".concat(C,".zip"),x.click(),URL.revokeObjectURL(x.href),l.next=18;break;case 15:l.prev=15,l.t0=l.catch(1),j("\u6587\u4EF6\u4E0B\u8F7D\u51FA\u9519\uFF01");case 18:return l.prev=18,A(!1),l.finish(18);case 21:case"end":return l.stop()}},y,null,[[1,15,18,21]])}));return function(){return E.apply(this,arguments)}}();return(0,e.jsx)(c.Fragment,{children:(0,e.jsxs)(me.u_,{onClose:h,title:"\u67E5\u770B\u6587\u4EF6\u5939",children:[(0,e.jsx)("div",{className:"px-5 overflow-y-auto  max-h-[260px]",children:F.map(function(E,y){var o=E.fileName.split("/");return(0,e.jsx)("div",{id:"view",className:"w-[640px] h-[34px] flex items-center ",children:(0,e.jsx)("span",{className:"ml-[10px] leading-5 text-[16px] font-normal",children:o[o.length-1]})},"file_".concat(y))})}),(0,e.jsx)("button",{disabled:L,className:"bg-[#29953A] w-full h-[50px] rounded-lg text-[#FFFFFF] mt-5",onClick:D,children:"\u4E0B\u8F7D"})]})})},ze=Te,ke=t(75632);function Pe(m){return"".concat(ke.Sg).concat(m)}function $e(){var m=(0,ee.is)();return m?{headers:{Authorization:"Bearer ".concat(m.loginToken)}}:{}}function Oe(m){var i,h=m.data;if(!h||h.code!==1e5)throw h.message;return(i=m.data)===null||i===void 0?void 0:i.data}function We(m){return ue.apply(this,arguments)}function ue(){return ue=$()(B()().mark(function m(i){var h;return B()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,xe.Z.get(Pe("/api/verifyRecord/list/?pageNum=".concat(i,"&pageSize=10")),$e());case 2:return h=f.sent,f.abrupt("return",Oe(h));case 4:case"end":return f.stop()}},m)})),ue.apply(this,arguments)}function Ze(){var m=(0,ee.oR)(),i=m.userData,h=(0,c.useState)(1),F=S()(h,2),f=F[0],p=F[1],L=(0,c.useState)({}),A=S()(L,2),j=A[0],D=A[1],E=(0,c.useState)(!1),y=S()(E,2),o=y[0],C=y[1],R=(0,c.useState)(!1),x=S()(R,2),W=x[0],l=x[1],n=(0,c.useRef)([]),Z=(0,c.useState)(!1),H=S()(Z,2),I=H[0],Y=H[1],k=(0,c.useRef)(),w=function(a){n.current=a,l(!0)},P=(0,c.useCallback)(function(s){C(!0),k.current={type:M().isEmpty(s)?"new":(i==null?void 0:i.role)==="verify"?"verify":"editor",recordId:s.id}},[i]),oe=(0,c.useMemo)(function(){return[{title:"\u9A8C\u8BC1\u8BB0\u5F55",dataIndex:"name",width:"10rem",render:function(a){return(0,e.jsx)("span",{"data-tooltip-content":(0,O.iT)(a,20),"data-tooltip-id":"tooltip",className:"w-[13rem] text-lg leading-[27px] truncate inline-block",children:a})}},{title:"\u9A8C\u8BC1\u8BB0\u5F55ID",dataIndex:"id",width:"6rem",render:function(a){return(0,e.jsx)("div",{className:"flex  text-lg leading-[27px]  w-[6rem]",children:(0,e.jsx)("span",{className:"",children:a})})}},{title:"\u53D1\u8D77\u4EBA",dataIndex:"loadNumber",width:"8rem",render:function(a,d){return(0,e.jsx)("span",{"data-tooltip-content":(0,O.iT)(d.createUser.name,20),"data-tooltip-id":"tooltip",className:"text-lg leading-[27px] max-w-[13rem]  truncate inline-block",children:d.createUser.name})}},{title:"\u7EC4\u7EC7\u673A\u6784",width:"2rem",dataIndex:"productName",render:function(a,d){return(0,e.jsx)("span",{className:" text-lg leading-[27px] max-w-[14rem] truncate inline-block ",children:d.organization.name})}},{title:"\u78B3\u8DB3\u8FF9\u6279\u6B21",dataIndex:"loadName",width:"10rem",render:function(a,d){return(0,e.jsx)("span",{"data-tooltip-content":(0,O.iT)(d.inventory.loadName,11),"data-tooltip-id":"tooltip",className:"w-[13rem] text-lg leading-[27px] truncate inline-block",children:d.inventory.loadName})}},{title:"\u78B3\u8DB3\u8FF9\u6279\u6B21ID",dataIndex:"loadNumber",width:"10rem",render:function(a){return(0,e.jsx)("span",{"data-tooltip-content":a,"data-tooltip-id":"tooltip",className:"w-[13rem] text-lg leading-[27px] truncate inline-block",children:(0,O.lS)(a,8,8)})}},{title:"\u9644\u4EF6",dataIndex:"productDescription",width:"18.75rem",render:function(a,d){return(0,e.jsxs)("div",{onClick:function(){return w(d.attachmentFileList)},className:"w-[112px] flex flex-row items-center bg-[#F1F1F1] justify-center rounded cursor-pointer",children:[(0,e.jsx)(le.SW,{}),(0,e.jsx)("div",{className:"ml-2 ",children:"\u6587\u4EF6\u5939V"})]})}},{title:"\u6700\u540E\u7F16\u8F91",dataIndex:"updateTime",width:"14rem",render:function(a){return(0,e.jsx)("span",{className:" text-lg leading-[27px] w-[12rem] ",children:a})}},{title:"\u9A8C\u8BC1\u4EBA",dataIndex:"name",width:"18.625rem",render:function(a,d){return(0,e.jsx)("span",{"data-tooltip-content":(0,O.iT)(d.verifyUser.name,11),"data-tooltip-id":"tooltip",className:"max-w-[11rem] text-lg leading-[27px]  truncate inline-block",children:d.verifyUser.name})}},{title:"\u9A8C\u8BC1\u6587\u6863",dataIndex:"verifyFileList",width:"8.125rem",render:function(a,d){return d.verifyFileList.length?(0,e.jsxs)("div",{onClick:function(){return w(d.verifyFileList)},className:"w-[112px] flex flex-row items-center bg-[#F1F1F1] justify-center rounded cursor-pointer",children:[(0,e.jsx)(le.SW,{}),(0,e.jsx)("div",{className:"ml-2 ",children:"\u6587\u4EF6\u5939"})]}):null}},{title:"\u9A8C\u8BC1\u72B6\u6001",dataIndex:"state",width:"8.125rem",render:function(a){return(0,e.jsx)("span",{className:" text-lg leading-[27px] max-w-[14rem] ",children:a?"\u5DF2\u9A8C\u8BC1":""})}},{title:"\u9A8C\u8BC1\u65F6\u95F4",dataIndex:"proofTime",width:"8.125rem",render:function(a){return(0,e.jsx)("span",{className:"text-lg leading-[27px] w-[13rem] ",children:a})}},{title:"",width:"20rem",render:function(a,d){return!d.state&&(0,e.jsx)("div",{className:"flex justify-between flex-1 text-green-2 break-keep",children:(0,e.jsx)("div",{className:"flex items-center font-normal justify-center cursor-pointer text-lg leading-[27px]",onClick:function(){return P(d)},children:"\u7F16\u8F91"})})}}]},[P]),V=function(){var s=$()(B()().mark(function a(){var d;return B()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,Y(!0),r.next=4,We(f);case 4:d=r.sent,D(d),r.next=11;break;case 8:r.prev=8,r.t0=r.catch(0),console.log("eeee",r.t0);case 11:return r.prev=11,Y(!1),r.finish(11);case 14:case"end":return r.stop()}},a,null,[[0,8,11,14]])}));return function(){return s.apply(this,arguments)}}();return(0,c.useEffect)(function(){V()},[f]),(0,e.jsxs)(ie._z,{children:[(0,e.jsxs)("div",{className:"",children:[(0,e.jsxs)("h3",{className:"flex items-center justify-between text-2xl font-semibold",children:[(0,e.jsx)("span",{children:"\u9A8C\u8BC1\u7BA1\u7406\u5217\u8868"}),(i==null?void 0:i.role)==="admin"&&(0,e.jsx)(J.z,{onClick:function(){return P({})},className:"w-40 text-lg font-normal text-white rounded-lg bg-green-2 h-11 hover:bg-green-28",children:"\u65B0\u5EFA\u9A8C\u8BC1\u8BB0\u5F55"})]}),(0,e.jsx)("div",{className:"w-full p-5 mt-5 bg-white rounded-2xl",children:(0,e.jsx)("div",{className:"pb-6 mt-5 overflow-x-auto",children:(0,e.jsx)("div",{className:"text-base leading-[1.625rem] min-w-[62.25rem]",children:(0,e.jsx)(N.i,{columns:oe,loading:I,columnsHeight:"h-[3.125rem] ",mouseHoverKey:"id",data:(j==null?void 0:j.records)||[],className:"",columnsClassName:" cursor-default ",headerClassName:{background:"#fff",fontWeight:"700",fontSize:"18px",lineHeight:"27px"}})})})})]}),(0,e.jsx)(Q.t,{className:"my-8",onChange:function(a){p(a)},total:j.total||0,pgSize:10,pgNum:f}),o&&k.current&&(0,e.jsx)(Ve,{type:k.current.type,recordId:k.current.recordId,closeModal:function(){p(1),f===1&&V(),C(!1),k.current=void 0}}),W&&(0,e.jsx)(ze,{fileList:n.current,closeModal:function(){l(!1)}})]})}var He=Ze,Ke=He}}]);
