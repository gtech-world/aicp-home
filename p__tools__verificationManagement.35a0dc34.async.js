"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[2941],{8965:function(he,G,t){t.d(G,{H4:function(){return ne},Kv:function(){return W},Tz:function(){return te},We:function(){return j},uU:function(){return l}});var ee=t(97207),b=t.n(ee),M=t(89585);function W(x){var V=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(0,M.ZP)("/api/product-system/".concat(x,"/detail"),{refreshInterval:V})}function ne(x){return(0,M.ZP)(b().isNil(x)?null:"/api/verifyRecord/".concat(x,"/detail"))}function j(x){return(0,M.ZP)(x?"/api/inventory/all":null)}function te(x){return(0,M.ZP)(x?"/api/verifyRecord/verifiers":null)}function l(x){var V=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(0,M.ZP)("/api/product-system/list/?pageNum=".concat(x,"&pageSize=10"),{refreshInterval:V})}},91234:function(he,G,t){t.d(G,{Yu:function(){return V},aH:function(){return x},pd:function(){return $},uJ:function(){return l}});var ee=t(22786),b=t.n(ee),M=t(46299),W=t.n(M),ne=t(99095),j=t(64470),te=t(90386);function l(N){return"".concat(te.Sg).concat(N)}function x(){var N=(0,ne.is)();return N?{headers:{Authorization:"Bearer ".concat(N.loginToken)}}:{}}function V(N){var k,h=N.data;if(!h||h.code!==1e5)throw h.message;return(k=N.data)===null||k===void 0?void 0:k.data}function $(N){return re.apply(this,arguments)}function re(){return re=W()(b()().mark(function N(k){var h;return b()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.next=2,j.default.get(l("/api/verifyRecord/list/?pageNum=".concat(k,"&pageSize=10")),x());case 2:return h=O.sent,O.abrupt("return",V(h));case 4:case"end":return O.stop()}},N)})),re.apply(this,arguments)}},11187:function(he,G,t){t.r(G),t.d(G,{default:function(){return We}});var ee=t(22786),b=t.n(ee),M=t(46299),W=t.n(M),ne=t(86516),j=t.n(ne),te=t(30541),l=t(79685),x=t(35259),V=t(75247),$=t(9991),re=t(70300),N=t.n(re),k=t(48651),h=t.n(k),se=t(99095),O=t(11e3),pe=t(95968),ue=t(27202),de=t(85223),ce=t(8965),ae=t(54916),De=t(97207),T=t.n(De);function Ae(){var K=arguments.length>0&&arguments[0]!==void 0?arguments[0]:5,c=(0,l.useRef)(new AbortController),L=function(y){var v=y,R=function(){if(v.length!==0){var g=v[0];return v=T().drop(v),{file:g,index:y.length-v.length-1}}},S=T().min([K,v.length]),C=T().range(y.length),w=function(){var B=W()(b()().mark(function g(){var o,F,U,m;return b()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(o=R(),!o){i.next=10;break}return F=o.file,U=o.index,i.next=6,(0,ae.qM)(F,{signal:c.current.signal});case 6:m=i.sent,C[U]=m,i.next=11;break;case 10:return i.abrupt("return");case 11:i.next=0;break;case 13:case"end":return i.stop()}},g)}));return function(){return B.apply(this,arguments)}}();return Promise.all(T().range(S).map(function(){return w()})).then(function(){return C})};return[L,function(){try{c.current.abort()}catch(A){console.info("abort upfiles")}}]}var _=t(81123),Se=t(68591),we=t.n(Se),Ie=t(98919),e=t(63342),p=function(c){return(0,e.jsxs)("div",{className:"w-full flex flex-col gap-2.5",children:[(0,e.jsxs)("span",{className:"font-normal leading-6 text-[16px]",children:[c.title,"\uFF1A"]}),c.children]})},D=function(c){return(0,e.jsx)("div",{className:"font-normal leading-[21.79px] text-[16px] text-gray-9",children:c.value})},Be=function(c){var L,A,y,v,R,S,C,w=c.closeModal,B=c.recordId,g=c.type,o=g===void 0?"new":g,F=(0,l.useRef)(null),U=(0,se.oR)(),m=U.userData,J=(0,ce.H4)(B),i=J.isLoading,n=J.data,Q=(0,ce.We)(o==="new"||o==="editor"),Y=Q.isLoading,I=Q.data,ie=(0,ce.Tz)(o==="new"||o==="editor"),H=ie.isLoading,E=ie.data,Z=i||Y||H,fe=(0,l.useMemo)(function(){return[(I||[]).map(function(u){return h()(h()({},u),{},{text:u.loadName})}),T().findIndex(I,function(u){return u.loadNumber===(n==null?void 0:n.loadNumber)})]},[I,n]),P=ue.dW.apply(void 0,N()(fe)),s=(0,l.useMemo)(function(){return[(E||[]).map(function(u){return h()(h()({},u),{},{text:u.name})}),T().findIndex(E,function(u){var f;return u.id===(n==null||(f=n.verifyUser)===null||f===void 0?void 0:f.id)})]},[E,n]),a=ue.dW.apply(void 0,N()(s)),d=(0,Ie.Z)({verifyState:!0}),X=j()(d,2),r=X[0],me=X[1],$e=Ae(),ge=j()($e,2),ve=ge[0],ke=ge[1];(0,l.useEffect)(function(){return ke},[]);var le=!r.files||r.files.length===0||r.files.length>20||T().findIndex(r.files,function(u){return u.size>=1024*1024*1024*2||u.name.length>=128})>=0,ye=!I||!E||!r.name||P.current<0||a.current<0||le,Ke=(0,l.useState)(!1),je=j()(Ke,2),z=je[0],q=je[1],He=function(){ye||z||(q(!0),ve(r.files).then(function(f){return(0,ae._Q)({name:r.name,loadNumber:I[P.current].loadNumber,description:r.desc||"",fileList:f,verifyUserId:E[a.current].id}).then(function(){return w(!0)}).catch(console.error).finally(function(){q(!1)})}))},Ne=!n||!I||!E||(r.name||n.name)===n.name&&(r.desc||n.description)===n.description&&((L=I[P.current])===null||L===void 0?void 0:L.loadNumber)===n.loadNumber&&((A=E[a.current])===null||A===void 0?void 0:A.id)===n.verifyUserId&&le,Ze=function(){if(!(Ne||z)){var f;q(!0),r.files?f=ve(r.files).then(function(oe){return(0,ae.u_)(n.id,{name:r.name||n.name,loadNumber:I[P.current].loadNumber,description:r.desc||n.description,fileList:oe,verifyUserId:E[a.current].id})}):f=(0,ae.u_)(n.id,{name:r.name,loadNumber:I[P.current].loadNumber,description:r.desc,verifyUserId:E[a.current].id}),f.then(function(){return w(!0)}).catch(console.error).finally(function(){q(!1)})}},Ce=!n||le,Ge=function(){Ce||!r.files||z||(q(!0),ve(r.files).then(function(f){return(0,ae.A6)(n.id,f,!0)}).then(function(){return w(!0)}).catch(console.error).finally(function(){q(!1)}))},_e={directory:"",webkitdirectory:""},Fe="w-full shrink-0 px-5 border border-[#DDDDDD]  h-[50px]  bg-[#F8F8F8] rounded-lg",Ee=o==="verify",Je=(0,l.useMemo)(function(){var u;if(le||!r.files)return"\u9A8C\u8BC1\u6587\u4EF6";var f=((u=r.files.item(0))===null||u===void 0?void 0:u.webkitRelativePath.split("/")[0])||"\u9A8C\u8BC1\u6587\u4EF6";return(0,_.lS)(f,10,10)},[r.files,le]),be=function(){return(0,e.jsx)(p,{title:Ee?"\u9A8C\u8BC1\u6587\u6863":"\u9644\u4EF6",children:(0,e.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,e.jsx)("input",h()(h()({},_e),{},{ref:F,type:"file",hidden:!0,onChange:function(oe){return me({files:oe.target.files})}})),(0,e.jsx)(de.SW,{}),(0,e.jsx)(D,{value:Je}),(0,e.jsx)("div",{onClick:function(oe){var xe;return!z&&((xe=F.current)===null||xe===void 0?void 0:xe.click())},className:we()("flex  rounded-[4px] leading-4 text-[16px] bg-[#F1F1F1] w-[100px] h-[24px]  text-center items-center justify-center ",z?"cursor-not-allowed":"cursor-pointer"),children:"\u9009\u62E9\u6587\u4EF6\u5939"})]})})};return(0,e.jsx)(l.Fragment,{children:(0,e.jsxs)(pe.u_,{className:"rounded-lg",containerClassName:"mx-5 max-w-[640px]",titleClassName:"text-[20px] leading-5 font-bold",title:o==="new"?"\u65B0\u5EFA\u9A8C\u8BC1\u8BB0\u5F55":"\u7F16\u8F91\u9A8C\u8BC1\u8BB0\u5F55",onClose:function(){return w(!1)},children:[(0,e.jsxs)("div",{className:"flex flex-col py-[1px] gap-5 px-5 w-[640px] min-h-[6.25rem] max-h-mc overflow-y-auto",children:[Z&&(0,e.jsx)(O.g,{}),!Z&&(0,e.jsx)(e.Fragment,{children:Ee?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(p,{title:"\u9A8C\u8BC1\u8BB0\u5F55",children:(0,e.jsx)(D,{value:n==null?void 0:n.name})}),(0,e.jsx)(p,{title:"\u9A8C\u8BC1\u8BB0\u5F55ID",children:(0,e.jsx)(D,{value:n==null?void 0:n.id})}),(0,e.jsx)(p,{title:"\u53D1\u8D77\u4EBA",children:(0,e.jsx)(D,{value:n==null||(y=n.createUser)===null||y===void 0?void 0:y.name})}),(0,e.jsx)(p,{title:"\u7EC4\u7EC7\u673A\u6784",children:(0,e.jsx)(D,{value:n==null||(v=n.organization)===null||v===void 0?void 0:v.name})}),(0,e.jsx)(p,{title:"\u63CF\u8FF0",children:(0,e.jsx)(D,{value:n==null?void 0:n.description})}),(0,e.jsx)(p,{title:"\u78B3\u8DB3\u8FF9\u6279\u6B21",children:(0,e.jsx)(D,{value:n==null||(R=n.inventory)===null||R===void 0?void 0:R.loadName})}),(0,e.jsx)(p,{title:"\u78B3\u8DB3\u8FF9\u6279\u6B21ID",children:(0,e.jsx)(D,{value:n==null?void 0:n.loadNumber})}),(0,e.jsx)(p,{title:"\u9A8C\u8BC1\u4EBA",children:(0,e.jsx)(D,{value:n==null||(S=n.verifyUser)===null||S===void 0?void 0:S.name})}),be()]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(p,{title:"\u9A8C\u8BC1\u8BB0\u5F55",children:(0,e.jsx)("input",{value:r.name||(n==null?void 0:n.name),onChange:function(f){return me({name:f.target.value})},maxLength:30,className:Fe})}),(0,e.jsx)(p,{title:"\u78B3\u8DB3\u8FF9\u6279\u6B21",children:(0,e.jsx)(ue.ub,h()({},P))}),(0,e.jsx)(p,{title:"\u63CF\u8FF0",children:(0,e.jsx)("input",{value:r.desc||(n==null?void 0:n.description),onChange:function(f){return me({desc:f.target.value})},maxLength:100,className:Fe})}),(0,e.jsx)(p,{title:"\u9009\u62E9\u9A8C\u8BC1\u4EBA",children:(0,e.jsx)(ue.ub,h()({},a))}),(0,e.jsx)(p,{title:"\u53D1\u8D77\u4EBA",children:(0,e.jsx)(D,{value:m==null?void 0:m.name})}),(0,e.jsx)(p,{title:"\u7EC4\u7EC7\u673A\u6784",children:(0,e.jsx)(D,{value:m==null||(C=m.organization)===null||C===void 0?void 0:C.name})}),be()]})})]}),!Z&&(0,e.jsxs)("div",{className:"flex flex-row justify-between gap-5 mt-5 w-full px-5",children:[o==="new"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)($.u,{defStyle:"btn-primary-1",className:"flex-1",onClick:function(){return w(!1)},children:"\u53D6\u6D88"}),(0,e.jsx)($.u,{busy:z,disabled:ye,defStyle:"btn-primary",className:"flex-1",onClick:He,children:"\u786E\u5B9A"})]}),o==="editor"&&(0,e.jsx)($.u,{busy:z,disabled:Ne,className:"flex-1",onClick:Ze,children:"\u63D0\u4EA4\u66F4\u65B0"}),o==="verify"&&(0,e.jsx)($.u,{busy:z,disabled:Ce,className:"flex-1",onClick:Ge,children:"\u63D0\u4EA4\u9A8C\u8BC1"})]})]})})},Me=Be,Le=t(30905),Re=t.n(Le),Ue=t(64470),Pe=function(c){var L=c.closeModal,A=c.fileList,y=(0,l.useState)(!1),v=j()(y,2),R=v[0],S=v[1],C=(0,se.h3)(),w=function(){var B=W()(b()().mark(function g(){var o,F,U,m;return b()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return S(!0),i.prev=1,o=new(Re()),F="",A.forEach(function(n){F=n.fileName.split("/")[0];var Q=Ue.default.get(n.downloadUrl,{responseType:"arraybuffer"}).then(function(Y){return Y.data});o.file(n.fileName,Q)}),i.next=7,o.generateAsync({type:"blob"});case 7:U=i.sent,m=document.createElement("a"),m.href=URL.createObjectURL(U),m.download="".concat(F,".zip"),m.click(),URL.revokeObjectURL(m.href),i.next=18;break;case 15:i.prev=15,i.t0=i.catch(1),C("\u6587\u4EF6\u4E0B\u8F7D\u51FA\u9519\uFF01");case 18:return i.prev=18,S(!1),i.finish(18);case 21:case"end":return i.stop()}},g,null,[[1,15,18,21]])}));return function(){return B.apply(this,arguments)}}();return(0,e.jsx)(l.Fragment,{children:(0,e.jsxs)(pe.u_,{onClose:L,title:"\u67E5\u770B\u6587\u4EF6\u5939",children:[(0,e.jsx)("div",{className:"px-5 overflow-y-auto  max-h-[260px]",children:A.map(function(B,g){var o=B.fileName.split("/");return(0,e.jsx)("div",{id:"view",className:"w-[640px] h-[34px] flex items-center ",children:(0,e.jsx)("span",{className:"ml-[10px] leading-5 text-[16px] font-normal",children:o[o.length-1]})},"file_".concat(g))})}),(0,e.jsx)("button",{disabled:R,className:"bg-[#29953A] w-full h-[50px] rounded-lg text-[#FFFFFF] mt-5",onClick:w,children:"\u4E0B\u8F7D"})]})})},Ve=Pe,Oe=t(91234);function Te(){var K=(0,se.oR)(),c=K.userData,L=(0,l.useState)(1),A=j()(L,2),y=A[0],v=A[1],R=(0,l.useState)({}),S=j()(R,2),C=S[0],w=S[1],B=(0,l.useState)(!1),g=j()(B,2),o=g[0],F=g[1],U=(0,l.useState)(!1),m=j()(U,2),J=m[0],i=m[1],n=(0,l.useRef)([]),Q=(0,l.useState)(!1),Y=j()(Q,2),I=Y[0],ie=Y[1],H=(0,l.useRef)(),E=function(a){n.current=a,i(!0)},Z=(0,l.useCallback)(function(s){F(!0),H.current={type:T().isEmpty(s)?"new":(c==null?void 0:c.role)==="verify"?"verify":"editor",recordId:s.id}},[c]),fe=(0,l.useMemo)(function(){return[{title:"\u9A8C\u8BC1\u8BB0\u5F55",dataIndex:"name",width:"10rem",render:function(a){return(0,e.jsx)("span",{"data-tooltip-content":(0,_.iT)(a,20),"data-tooltip-id":"tooltip",className:"w-[13rem] text-lg leading-[27px] truncate inline-block",children:a})}},{title:"\u9A8C\u8BC1\u8BB0\u5F55ID",dataIndex:"id",width:"6rem",render:function(a){return(0,e.jsx)("div",{className:"flex  text-lg leading-[27px]  w-[6rem]",children:(0,e.jsx)("span",{className:"",children:a})})}},{title:"\u53D1\u8D77\u4EBA",dataIndex:"loadNumber",width:"8rem",render:function(a,d){return(0,e.jsx)("span",{"data-tooltip-content":(0,_.iT)(d.createUser.name,20),"data-tooltip-id":"tooltip",className:"text-lg leading-[27px] max-w-[13rem]  truncate inline-block",children:d.createUser.name})}},{title:"\u7EC4\u7EC7\u673A\u6784",width:"2rem",dataIndex:"productName",render:function(a,d){return(0,e.jsx)("span",{className:" text-lg leading-[27px] max-w-[14rem] truncate inline-block ",children:d.organization.name})}},{title:"\u78B3\u8DB3\u8FF9\u6279\u6B21",dataIndex:"loadName",width:"10rem",render:function(a,d){return(0,e.jsx)("span",{"data-tooltip-content":(0,_.iT)(d.inventory.loadName,11),"data-tooltip-id":"tooltip",className:"w-[13rem] text-lg leading-[27px] truncate inline-block",children:d.inventory.loadName})}},{title:"\u78B3\u8DB3\u8FF9\u6279\u6B21ID",dataIndex:"loadNumber",width:"10rem",render:function(a){return(0,e.jsx)("span",{"data-tooltip-content":a,"data-tooltip-id":"tooltip",className:"w-[13rem] text-lg leading-[27px] truncate inline-block",children:(0,_.lS)(a,8,8)})}},{title:"\u9644\u4EF6",dataIndex:"productDescription",width:"18.75rem",render:function(a,d){return(0,e.jsxs)("div",{onClick:function(){return E(d.attachmentFileList)},className:"w-[112px] flex flex-row items-center bg-[#F1F1F1] justify-center rounded cursor-pointer",children:[(0,e.jsx)(de.SW,{}),(0,e.jsx)("div",{className:"ml-2 ",children:"\u6587\u4EF6\u5939V"})]})}},{title:"\u6700\u540E\u7F16\u8F91",dataIndex:"updateTime",width:"14rem",render:function(a){return(0,e.jsx)("span",{className:" text-lg leading-[27px] w-[12rem] ",children:a})}},{title:"\u9A8C\u8BC1\u4EBA",dataIndex:"name",width:"18.625rem",render:function(a,d){return(0,e.jsx)("span",{"data-tooltip-content":(0,_.iT)(d.verifyUser.name,11),"data-tooltip-id":"tooltip",className:"max-w-[11rem] text-lg leading-[27px]  truncate inline-block",children:d.verifyUser.name})}},{title:"\u9A8C\u8BC1\u6587\u6863",dataIndex:"verifyFileList",width:"8.125rem",render:function(a,d){return d.verifyFileList.length?(0,e.jsxs)("div",{onClick:function(){return E(d.verifyFileList)},className:"w-[112px] flex flex-row items-center bg-[#F1F1F1] justify-center rounded cursor-pointer",children:[(0,e.jsx)(de.SW,{}),(0,e.jsx)("div",{className:"ml-2 ",children:"\u6587\u4EF6\u5939"})]}):null}},{title:"\u9A8C\u8BC1\u72B6\u6001",dataIndex:"state",width:"8.125rem",render:function(a){return(0,e.jsx)("span",{className:" text-lg leading-[27px] max-w-[14rem] ",children:a?"\u5DF2\u9A8C\u8BC1":""})}},{title:"\u9A8C\u8BC1\u65F6\u95F4",dataIndex:"proofTime",width:"8.125rem",render:function(a){return(0,e.jsx)("span",{className:"text-lg leading-[27px] w-[13rem] ",children:a})}},{title:"",width:"20rem",render:function(a,d){return!d.state&&(0,e.jsx)("div",{className:"flex justify-between flex-1 text-green-2 break-keep",children:(0,e.jsx)("div",{className:"flex items-center font-normal justify-center cursor-pointer text-lg leading-[27px]",onClick:function(){return Z(d)},children:"\u7F16\u8F91"})})}}]},[Z]),P=function(){var s=W()(b()().mark(function a(){var d;return b()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,ie(!0),r.next=4,(0,Oe.pd)(y);case 4:d=r.sent,w(d),r.next=11;break;case 8:r.prev=8,r.t0=r.catch(0),console.log("eeee",r.t0);case 11:return r.prev=11,ie(!1),r.finish(11);case 14:case"end":return r.stop()}},a,null,[[0,8,11,14]])}));return function(){return s.apply(this,arguments)}}();return(0,l.useEffect)(function(){P()},[y]),(0,e.jsxs)(te._z,{children:[(0,e.jsxs)("div",{className:"",children:[(0,e.jsxs)("h3",{className:"flex items-center justify-between text-2xl font-semibold",children:[(0,e.jsx)("span",{children:"\u9A8C\u8BC1\u7BA1\u7406\u5217\u8868"}),(c==null?void 0:c.role)==="admin"&&(0,e.jsx)($.z,{onClick:function(){return Z({})},className:"w-40 text-lg font-normal text-white rounded-lg bg-green-2 h-11 hover:bg-green-28",children:"\u65B0\u5EFA\u9A8C\u8BC1\u8BB0\u5F55"})]}),(0,e.jsx)("div",{className:"w-full p-5 mt-5 bg-white rounded-2xl",children:(0,e.jsx)("div",{className:"pb-6 mt-5 overflow-x-auto",children:(0,e.jsx)("div",{className:"text-base leading-[1.625rem] min-w-[62.25rem]",children:(0,e.jsx)(x.i,{columns:fe,loading:I,columnsHeight:"h-[3.125rem] ",mouseHoverKey:"id",data:(C==null?void 0:C.records)||[],className:"",columnsClassName:" cursor-default ",headerClassName:{background:"#fff",fontWeight:"700",fontSize:"18px",lineHeight:"27px"}})})})})]}),(0,e.jsx)(V.t,{className:"my-8",onChange:function(a){v(a)},total:C.total||0,pgSize:10,pgNum:y}),o&&H.current&&(0,e.jsx)(Me,{type:H.current.type,recordId:H.current.recordId,closeModal:function(){v(1),y===1&&P(),F(!1),H.current=void 0}}),J&&(0,e.jsx)(Ve,{fileList:n.current,closeModal:function(){i(!1)}})]})}var ze=Te,We=ze}}]);
